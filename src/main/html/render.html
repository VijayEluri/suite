<meta charset='utf-8'>
<html>
	<body>
		<div id='target'></div>
	</body>

	<script src='frp.js'></script>
	<script src='fun.js'></script>

	<script type='text/javascript'>
'use strict';

let element = (tag, attrs, children) => {
	let el = document.createElement(tag);
	for (let [key, value] of Object.entries(attrs)) el.setAttribute(key, value);
	for (let child of children) el.appendChild(child);
	return el;
};

let element_p = children => element('p', {}, children);

let updateOnlyChild = (parent, el1) => {
	let children = parent.childNodes;
	if (children.length == 0)
		parent.appendChild(el1);
	else
		parent.replaceChild(el1, children[0]);
};

let rd_text = (vm0, vm1) => {
	return element_p([document.createTextNode(vm1)]);
};

let rd = (vm0, vm1) => dom => {
	if (vm0 == null)
		dom.appendChild(rd_text(null, vm1.message));
	else if (vm0 != vm1)
		updateOnlyChild(dom, rd_text(vm0.message, vm1.message));
};

let pvm = null;

let renderAgain = vm => {
	rd(pvm, vm)(document.getElementById('target'));
	pvm = vm;
};

renderAgain({ message: 'hello world0', });
renderAgain({ message: 'hello world1', });
renderAgain({ message: 'hello world2', });
renderAgain({ message: 'hello world', });
	</script>

</html>

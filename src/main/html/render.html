<meta charset='utf-8'>
<html>
	<body>
		<div id='target'></div>
	</body>

	<script src='frp.js'></script>
	<script src='fun.js'></script>

	<script type='text/javascript'>
'use strict';

let element = (tag, attrs, children) => {
	let el = document.createElement(tag);
	for (let [key, value] of Object.entries(attrs)) el.setAttribute(key, value);
	for (let child of children) el.appendChild(child);
	return el;
};

let element_p = children => element('p', {}, children);

let updateOnlyChild = (parent, el1) => {
	let children = parent.children;
	if (children.length == 0)
		parent.appendChild(el1);
	else {
		let el0 = children[0];
		parent.replaceChild(el1, el0);
	}
};

let pwm = new WeakMap();

let rd = (vm0, vm1) => dom => {
	if (vm0 != vm1) updateOnlyChild(dom, element_p([document.createTextNode(vm1.message)]));
};

let body = document.getElementById('target');

let pvm = null;
let renderAgain = vm => { rd(pvm, vm)(body); pvm = vm; };

renderAgain({ message: 'hello world0', });
renderAgain({ message: 'hello world1', });
renderAgain({ message: 'hello world2', });
renderAgain({ message: 'hello world', });
	</script>

</html>
